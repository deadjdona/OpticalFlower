# Betafly Optical Position Stabilization

Advanced position stabilization with **web interface**, **multiple camera support**, and **manual stick inputs**.

## âœ¨ What's New

- ğŸŒ **Web Interface** - Real-time dashboard at http://raspberrypi.local:8080
- ğŸ“· **Camera Support** - USB, CSI, Analog FPV cameras, and PMW3901 sensor
- ğŸ® **RC Integration** - SBUS/PWM stick inputs with smooth blending
- ğŸ”§ **Live Config** - Edit settings through web GUI

## Quick Start

```bash
# 1. Run setup script
./setup.sh

# 2. Test sensor (PMW3901 or camera)
./test_sensor.py

# 3. Start with web interface (recommended)
./betafly_stabilizer_advanced.py

# 4. Open browser to: http://raspberrypi.local:8080
```

## Alternative: Basic Usage (No Web Interface)

```bash
# Original simple version
./betafly_stabilizer.py --mode velocity_damping
```

## Documentation

- **[README.md](README.md)** - Complete documentation and hardware setup
- **[FEATURES.md](FEATURES.md)** - Guide to new features (web, cameras, sticks)
- **[INSTALL.md](INSTALL.md)** - Detailed installation instructions

## Key Files

### Main Scripts
- `betafly_stabilizer_advanced.py` â­ - **Use this!** Full-featured version
- `betafly_stabilizer.py` - Basic version (PMW3901 only)
- `web_interface.py` - Web server (auto-started)

### Core Modules
- `optical_flow_sensor.py` - PMW3901 sensor
- `camera_optical_flow.py` - Camera-based optical flow
- `position_stabilizer.py` - PID controllers
- `stick_input.py` - RC receiver handling

### Configuration
- `config.json` - Main configuration file
- `requirements.txt` - Python dependencies

### Web Interface
- `templates/index.html` - Dashboard UI
- `static/css/style.css` - Styling
- `static/js/app.js` - Frontend code

## Supported Sensors

1. **PMW3901** - Dedicated optical flow sensor (SPI, original)
2. **Caddx Infra 256** â­ - Infrared optical flow (I2C, recommended)
3. **USB Camera** - Any USB webcam
4. **CSI Camera** - Raspberry Pi Camera Module
5. **Analog Camera** - FPV camera via USB capture card

Configure in `config.json`:
```json
{
  "sensor": {
    "type": "pmw3901"  // or "usb_camera", "analog_usb", etc.
  }
}
```

## Web Interface Features

Access at `http://raspberrypi.local:8080`

- ğŸ“Š Real-time position tracking (2D visualization)
- ğŸ“ˆ Live velocity and control outputs
- ğŸ›ï¸ Mode switching (Off / Velocity Damping / Position Hold)
- âš™ï¸ PID tuning interface
- ğŸ“· Camera configuration
- ğŸ® Stick input monitoring
- ğŸ’¾ Save configuration changes

## RC Integration

Supports SBUS and PWM protocols for manual control:

```json
{
  "stick_input": {
    "enabled": true,
    "protocol": "sbus",  // or "pwm", "mock"
    "device": "/dev/ttyAMA0",
    "mix_ratio": 0.5  // 0=full stab, 1=full manual
  }
}
```

Use RC switch to change modes in flight!
